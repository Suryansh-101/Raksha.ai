<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raksha.ai | Glassmorphism Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { 
            background: #020617; 
            color: #e2e8f0; 
            font-family: system-ui, -apple-system, sans-serif; 
            overflow-x: hidden;
        }
        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .glass-hover:hover {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(225, 29, 72, 0.15);
        }
        .glass-nav {
            background: rgba(2, 6, 23, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* Ambient Background Blobs */
        .ambient-light {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            background: 
                radial-gradient(circle at 15% 50%, rgba(76, 29, 149, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(225, 29, 72, 0.15), transparent 25%);
            pointer-events: none;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .animate-pulse-fast { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body>
    <div class="ambient-light"></div>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, memo, useRef } = React;

        // --- 1. OPTIMIZED ICONS ---
        const paths = {
            shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
            siren: "M7 18v-6a5 5 0 1 1 10 0v6M5 21a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2M21 12h1M18.5 4.5 20 3M2 12h1M4 3 5.5 4.5",
            video: "m22 8-6 4 6 4V8ZM2 6h14v12H2z",
            users: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 3a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75",
            map: "M3 6l6-3 6 3 6-3v15l-6 3-6-3-6 3V6zM9 3v15M15 6v15",
            phone: "M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",
            trash: "M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",
            plus: "M5 12h14M12 5v14",
            menu: "M4 12h16M4 6h16M4 18h16",
            x: "M18 6 6 18M6 6l12 12",
            alert: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",
            heart: "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",
            scale: "m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z m-14 0 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z M7 21h10 M12 3v18 M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",
            lock: "M3 11h18v11H3z M7 11V7a5 5 0 0 1 10 0v4",
            chart: "M12 20V10 M18 20V4 M6 20v-4"
        };
        const Icon = memo(({ name, className = "w-6 h-6", color = "currentColor" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d={paths[name] || ""} />
            </svg>
        ));

        // --- 2. LOGIC HOOKS ---
        const usePersistedState = (key, defaultValue) => {
            const [state, setState] = useState(() => {
                try { return JSON.parse(localStorage.getItem(key)) || defaultValue; } 
                catch { return defaultValue; }
            });
            useEffect(() => { localStorage.setItem(key, JSON.stringify(state)); }, [key, state]);
            return [state, setState];
        };

        const useGeolocation = () => {
            const [loc, setLoc] = useState(null);
            useEffect(() => {
                if (!navigator.geolocation) return;
                const id = navigator.geolocation.watchPosition(
                    p => setLoc({ lat: p.coords.latitude, lng: p.coords.longitude }),
                    e => console.warn(e),
                    { enableHighAccuracy: true }
                );
                return () => navigator.geolocation.clearWatch(id);
            }, []);
            return loc;
        };

        // --- 3. GLASS COMPONENTS ---
        const FeatureCard = ({ icon, title, desc, color }) => (
            <div className="glass glass-hover p-6 rounded-2xl transition-all duration-300 group">
                <div className={`w-12 h-12 rounded-xl flex items-center justify-center mb-4 bg-white/5 border border-white/5 group-hover:scale-110 transition-transform ${color}`}>
                    <Icon name={icon} className="w-6 h-6" />
                </div>
                <h3 className="text-xl font-bold text-white mb-2">{title}</h3>
                <p className="text-slate-400 text-sm leading-relaxed">{desc}</p>
            </div>
        );

        const ContactItem = memo(({ contact, onRemove }) => (
            <div className="flex justify-between items-center bg-white/5 p-4 rounded-xl border border-white/5 backdrop-blur-sm">
                <div className="flex items-center gap-3">
                    <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-rose-500 to-purple-600 flex items-center justify-center text-xs font-bold">
                        {contact.name[0]}
                    </div>
                    <div>
                        <div className="font-bold text-slate-200 text-sm">{contact.name}</div>
                        <div className="text-xs text-slate-500">{contact.phone}</div>
                    </div>
                </div>
                <button onClick={() => onRemove(contact.id)} className="text-white/40 hover:text-red-400 transition-colors">
                    <Icon name="trash" className="w-4 h-4" />
                </button>
            </div>
        ));

        // --- 4. MAIN APP ---
        const App = () => {
            const [view, setView] = useState('home');
            const [contacts, setContacts] = usePersistedState('raksha_contacts', []);
            const [logs, setLogs] = usePersistedState('raksha_logs', []);
            const [sosActive, setSosActive] = useState(false);
            const location = useGeolocation();
            const videoRef = useRef(null);

            const triggerSOS = useCallback(() => {
                if (sosActive) return;
                setSosActive(true);
                const newLog = { id: Date.now(), time: new Date().toLocaleTimeString(), loc: location ? `${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}` : 'No GPS' };
                setLogs(prev => [newLog, ...prev]);
                setTimeout(() => { alert(`ðŸš¨ EMERGENCY ALERT SENT ðŸš¨\n\nSent to: ${contacts.length} Contacts\nLocation: ${newLog.loc}`); setSosActive(false); }, 2500);
            }, [sosActive, location, contacts, setLogs]);

            const startCam = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    if (videoRef.current) videoRef.current.srcObject = stream;
                } catch (e) { alert("Camera access required for evidence mode."); }
            };

            return (
                <div className="min-h-screen flex flex-col relative overflow-hidden">
                    
                    {/* Glass Navbar */}
                    <nav className="sticky top-0 z-50 glass-nav px-6 h-20 flex items-center justify-between">
                        <div className="flex items-center gap-3 cursor-pointer group" onClick={() => setView('home')}>
                            <div className="relative">
                                <div className="absolute inset-0 bg-rose-500 blur-lg opacity-40 group-hover:opacity-60 transition-opacity"></div>
                                <div className="relative bg-gradient-to-br from-slate-800 to-slate-950 border border-white/10 p-2 rounded-xl">
                                    <Icon name="shield" className="w-6 h-6 text-rose-500" />
                                </div>
                            </div>
                            <span className="text-2xl font-black text-white tracking-tight">Raksha<span className="text-rose-500">.ai</span></span>
                        </div>
                        <div className="flex gap-1 bg-white/5 p-1 rounded-full border border-white/5 backdrop-blur-md">
                            {['home', 'dashboard', 'map'].map(v => (
                                <button key={v} onClick={() => setView(v)} 
                                    className={`px-6 py-2 rounded-full text-sm font-bold capitalize transition-all duration-300 ${view === v ? 'bg-gradient-to-r from-rose-600 to-purple-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 max-w-6xl mx-auto w-full p-6 lg:p-10">
                        
                        {view === 'home' && (
                            <div className="flex flex-col lg:flex-row items-center justify-between gap-20 py-10">
                                <div className="lg:w-1/2 space-y-8">
                                    <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-rose-500/10 border border-rose-500/20 text-rose-400 text-xs font-bold uppercase tracking-wider">
                                        <span className="w-2 h-2 rounded-full bg-rose-500 animate-pulse"></span> Live Protection Active
                                    </div>
                                    <h1 className="text-6xl lg:text-7xl font-black text-white leading-tight">
                                        Safety in <br/>
                                        <span className="text-transparent bg-clip-text bg-gradient-to-r from-rose-400 via-fuchsia-500 to-indigo-500 animate-pulse">Transparency.</span>
                                    </h1>
                                    <p className="text-lg text-slate-400 max-w-xl leading-relaxed">
                                        A next-gen PWA leveraging browser APIs for offline-first protection. Zero backend latency. 100% Client-side privacy.
                                    </p>
                                    <div className="flex gap-4">
                                        <button onClick={() => setView('dashboard')} className="px-8 py-4 bg-white text-black rounded-xl font-bold hover:scale-105 transition-transform">
                                            Open Dashboard
                                        </button>
                                        <button className="px-8 py-4 glass text-white rounded-xl font-bold hover:bg-white/10 transition-colors">
                                            Learn More
                                        </button>
                                    </div>
                                    
                                    {/* Glass Features Grid */}
                                    <div className="grid grid-cols-2 gap-4 pt-8">
                                        <div className="glass p-4 rounded-xl flex items-center gap-3">
                                            <Icon name="video" className="text-blue-400"/> <div><div className="font-bold">Auto-Rec</div><div className="text-xs text-slate-500">Evidence Cloud</div></div>
                                        </div>
                                        <div className="glass p-4 rounded-xl flex items-center gap-3">
                                            <Icon name="map" className="text-emerald-400"/> <div><div className="font-bold">Live GPS</div><div className="text-xs text-slate-500">Real-time Sync</div></div>
                                        </div>
                                    </div>
                                </div>

                                {/* Phone Mockup */}
                                <div className="relative group">
                                    <div className="absolute inset-0 bg-gradient-to-b from-rose-500 to-purple-600 blur-3xl opacity-20 group-hover:opacity-30 transition-opacity duration-700"></div>
                                    <div className="relative w-[340px] h-[680px] bg-slate-950 rounded-[3rem] border-8 border-slate-900 shadow-2xl overflow-hidden flex flex-col p-6 pt-12 ring-1 ring-white/10">
                                        {/* Dynamic Island */}
                                        <div className="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-black rounded-b-2xl z-20 flex items-center justify-center gap-2">
                                            <div className="w-1 h-1 rounded-full bg-green-500"></div>
                                            <div className="w-1 h-1 rounded-full bg-orange-500"></div>
                                        </div>
                                        
                                        {/* App UI inside Phone */}
                                        <div className="flex justify-between items-center text-white mb-10 mt-2">
                                            <div>
                                                <h3 className="font-bold text-lg">Hello, User</h3>
                                                <p className="text-[10px] text-emerald-400 flex items-center gap-1 font-mono">
                                                    GPS: {location ? 'LOCKED' : 'SEARCHING'}
                                                </p>
                                            </div>
                                            <div className="w-10 h-10 bg-gradient-to-tr from-rose-500 to-purple-600 rounded-full flex items-center justify-center font-bold shadow-lg shadow-purple-500/30">A</div>
                                        </div>

                                        <div className="relative z-10">
                                            <button onClick={triggerSOS} className={`w-full aspect-square rounded-full flex flex-col items-center justify-center transition-all duration-500 ${sosActive ? 'bg-red-600 scale-105 shadow-[0_0_80px_rgba(220,38,38,0.6)]' : 'bg-gradient-to-b from-rose-600 to-rose-800 shadow-[0_20px_50px_-10px_rgba(225,29,72,0.5)] hover:scale-105 group-hover:shadow-[0_30px_60px_-15px_rgba(225,29,72,0.6)]'}`}>
                                                <Icon name="siren" className="w-20 h-20 text-white mb-2 drop-shadow-lg" />
                                                <span className="text-3xl font-black text-white tracking-[0.2em] drop-shadow-md">SOS</span>
                                                <span className="text-[10px] font-bold text-white/60 mt-2 border border-white/20 px-2 py-0.5 rounded-full">HOLD 3 SEC</span>
                                            </button>
                                        </div>

                                        <div className="mt-auto grid grid-cols-2 gap-3">
                                            <div className="bg-white/5 border border-white/5 p-4 rounded-2xl text-center backdrop-blur-sm">
                                                <Icon name="map" className="mx-auto text-emerald-400 mb-2"/>
                                                <div className="text-xs font-bold text-slate-300">Safe Map</div>
                                            </div>
                                            <div className="bg-white/5 border border-white/5 p-4 rounded-2xl text-center backdrop-blur-sm">
                                                <Icon name="users" className="mx-auto text-pink-400 mb-2"/>
                                                <div className="text-xs font-bold text-slate-300">Contacts ({contacts.length})</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'dashboard' && (
                            <div className="grid md:grid-cols-2 gap-8 animate-fade-in">
                                {/* Contacts Glass Panel */}
                                <div className="glass p-8 rounded-3xl h-fit">
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-2xl font-bold text-white flex items-center gap-3">
                                            <div className="p-2 bg-pink-500/20 rounded-lg text-pink-500"><Icon name="users" /></div>
                                            Trusted Circle
                                        </h2>
                                        <span className="text-xs font-mono bg-white/10 px-2 py-1 rounded text-slate-400">{contacts.length}/5</span>
                                    </div>
                                    
                                    <form onSubmit={e => {
                                        e.preventDefault();
                                        const fd = new FormData(e.target);
                                        const name = fd.get('name'), phone = fd.get('phone');
                                        if(name && phone) {
                                            setContacts(p => [...p, { id: Date.now(), name, phone }]);
                                            e.target.reset();
                                        }
                                    }} className="flex gap-3 mb-6">
                                        <input name="name" placeholder="Contact Name" className="bg-black/30 border border-white/10 rounded-xl p-3 flex-1 text-sm text-white focus:outline-none focus:border-rose-500 transition-colors" required/>
                                        <input name="phone" placeholder="Phone" className="bg-black/30 border border-white/10 rounded-xl p-3 w-28 text-sm text-white focus:outline-none focus:border-rose-500 transition-colors" required/>
                                        <button className="bg-rose-600 hover:bg-rose-700 w-12 rounded-xl flex items-center justify-center text-white shadow-lg shadow-rose-600/20 transition-all"><Icon name="plus" /></button>
                                    </form>

                                    <div className="space-y-3 max-h-[400px] overflow-y-auto scrollbar-hide">
                                        {contacts.length ? contacts.map(c => <ContactItem key={c.id} contact={c} onRemove={id => setContacts(p => p.filter(x => x.id !== id))} />) : 
                                            <div className="text-center py-8 text-slate-500 border-2 border-dashed border-white/5 rounded-xl">
                                                Add trusted contacts to notify during emergencies.
                                            </div>
                                        }
                                    </div>
                                </div>

                                {/* Tools Glass Panel */}
                                <div className="space-y-6">
                                    <div className="glass p-8 rounded-3xl relative overflow-hidden">
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 blur-3xl rounded-full"></div>
                                        <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                                            <div className="p-2 bg-blue-500/20 rounded-lg text-blue-500"><Icon name="video" /></div>
                                            Evidence Recorder
                                        </h2>
                                        <div className="relative aspect-video bg-black rounded-2xl overflow-hidden flex items-center justify-center mb-4 border border-white/10 shadow-2xl">
                                            <video ref={videoRef} autoPlay playsInline muted className="w-full h-full object-cover"/>
                                            <div className="absolute top-4 right-4 flex gap-2">
                                                <div className="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                                                <span className="text-[10px] font-mono text-red-500">LIVE</span>
                                            </div>
                                            <button onClick={startCam} className="absolute bottom-6 bg-white/10 hover:bg-white/20 backdrop-blur border border-white/10 px-6 py-2 rounded-full text-xs font-bold transition-all">
                                                Start Camera Stream
                                            </button>
                                        </div>
                                    </div>

                                    <div className="glass p-8 rounded-3xl h-64">
                                        <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                                            <div className="p-2 bg-purple-500/20 rounded-lg text-purple-500"><Icon name="alert" /></div>
                                            Incident Log
                                        </h2>
                                        <div className="space-y-3 overflow-y-auto max-h-32 scrollbar-hide">
                                            {logs.length ? logs.map(l => (
                                                <div key={l.id} className="flex justify-between items-center text-sm p-3 rounded-lg bg-white/5 border-l-2 border-rose-500">
                                                    <span className="text-slate-300">{l.time}</span>
                                                    <span className="font-mono text-xs text-rose-400">{l.loc}</span>
                                                </div>
                                            )) : <div className="text-slate-500 text-sm italic">No incidents recorded locally.</div>}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {view === 'map' && (
                            <div className="glass p-1 rounded-3xl h-[600px] flex items-center justify-center relative overflow-hidden animate-fade-in">
                                <div className="absolute inset-0 bg-slate-900/50">
                                    <div className="grid grid-cols-6 grid-rows-6 h-full w-full opacity-10">
                                        {[...Array(36)].map((_,i)=><div key={i} className="border border-white/20"></div>)}
                                    </div>
                                </div>
                                <div className="text-center z-10 p-10 bg-black/40 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl">
                                    <Icon name="map" className="w-20 h-20 text-emerald-500 mx-auto mb-6 animate-bounce"/>
                                    <h2 className="text-3xl font-bold text-white mb-2">Live Tracking Active</h2>
                                    <div className="font-mono text-emerald-400 bg-emerald-500/10 px-4 py-2 rounded-lg border border-emerald-500/20 mb-6">
                                        {location ? `${location.lat.toFixed(6)}, ${location.lng.toFixed(6)}` : 'Triangulating Satellite Signal...'}
                                    </div>
                                    <button onClick={() => setView('home')} className="text-slate-400 hover:text-white text-sm">Cancel Tracking</button>
                                </div>
                            </div>
                        )}

                    </main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
